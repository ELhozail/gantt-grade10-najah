<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>×œ×•×— ×’×× ×˜ â€” ××œ× ×’'××— Ø±Ù‡Ø· (×©×›×‘×” ×™×³)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { background:#11121a; color:#e8e8f0; }
    .hero-dark { background:linear-gradient(120deg,#191b28,#23263a,#2b2e44); }
    .card { background:#1b1d2b; border-radius:20px; }
    .legend span { margin-inline-end:1rem; }
    .gantt .bar-×¤×“×’×•×’×™{fill:#ef4b6c;} .gantt .bar-×§×”×™×œ×ª×™{fill:#1fb6d5;}
    .gantt .bar-×˜×›× ×•×œ×•×’×™{fill:#ff9800;} .gantt .bar-××•×¡×“×™{fill:#43a047;}
    .gantt .bar-×—×‘×¨×ª×™{fill:#9e9e9e;}
  </style>
</head>
<body>
<header class="hero-dark py-4 mb-3">
  <div class="container d-flex flex-wrap justify-content-between align-items-center gap-3">
    <div class="d-flex align-items-center gap-3">
      <img src="logo.png" alt="×œ×•×’×• ×‘×™×ª ×¡×¤×¨" style="height:60px;">
      <div>
        <h1 class="h3 mb-1 text-light">ğŸ“˜ ××œ× ×’'××— â€“ Ø±Ù‡Ø· (×©×›×‘×” ×™×³)</h1>
        <div class="legend small">
          <span><i style="background:#ef4b6c;width:14px;height:14px;display:inline-block"></i> ×¤×“×’×•×’×™</span>
          <span><i style="background:#1fb6d5;width:14px;height:14px;display:inline-block"></i> ×§×”×™×œ×ª×™</span>
          <span><i style="background:#ff9800;width:14px;height:14px;display:inline-block"></i> ×˜×›× ×•×œ×•×’×™</span>
          <span><i style="background:#43a047;width:14px;height:14px;display:inline-block"></i> ××•×¡×“×™</span>
          <span><i style="background:#9e9e9e;width:14px;height:14px;display:inline-block"></i> ×—×‘×¨×ª×™</span>
        </div>
      </div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-light btn-sm" href="gantt-template.xlsx" download>â¬‡ï¸ ×”×•×¨×“ ×ª×‘× ×™×ª Excel</a>
      <button id="btn-export" class="btn btn-outline-light btn-sm">×™×¦×•× CSV</button>
    </div>
  </div>
</header>

<main class="container pb-5">
  <div class="card">
    <div class="card-body" style="overflow-x:auto;">
      <div id="gantt" style="min-width:1100px;"></div>
    </div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
<script>
  let TASKS = [];

  function normalizeTask(t){
    return {
      id: t.id,
      domain: t.domain,
      name: t.name,
      start: t.start,
      end: t.end,
      progress: Number(t.progress || 0),
    };
  }

  function render(){
    if(!TASKS.length){
      document.getElementById('gantt').innerHTML = "<p class='text-center text-muted p-4'>××™×Ÿ × ×ª×•× ×™×</p>";
      return;
    }
    new Gantt("#gantt", TASKS.map(t=>({
      id:t.id, name:t.name, start:t.start, end:t.end, progress:t.progress,
      custom_class:'bar-'+t.domain
    })), { view_mode:"Month" });
  }

  function exportCSV(){
    const headers = ["id","domain","name","start","end","progress"];
    const rows = TASKS.map(t=>headers.map(h=>t[h]??""));
    const csv = [headers,...rows].map(r=>r.join(",")).join("\\n");
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const a = document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="gantt.csv"; a.click();
  }
  document.getElementById("btn-export").addEventListener("click", exportCSV);

  // ×˜×¢×™× ×ª × ×ª×•× ×™× ××”×§×•×‘×¥ data.json
  fetch("data.json")
    .then(r=>r.json())
    .then(data=>{
      TASKS = data.map(normalizeTask);
      render();
    })
    .catch(err=>{
      console.error("×©×’×™××” ×‘×˜×¢×™× ×”",err);
      document.getElementById("gantt").innerHTML="<p class='text-danger'>×‘×¢×™×” ×‘×˜×¢×™× ×ª data.json</p>";
    });
</script>
</body>
</html>
