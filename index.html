<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>לוח גאנט — בית הספר</title>

  <link rel="stylesheet" href="https://unpkg.com/vis-timeline@7.7.0/styles/vis-timeline-graph2d.min.css">
  <script src="https://unpkg.com/vis-data@7.1.4/peer/umd/vis-data.min.js"></script>
  <script src="https://unpkg.com/vis-timeline@7.7.0/peer/umd/vis-timeline-graph2d.min.js"></script>

  <style>
    :root{
      --bg:#f7f7f9;
      --card:#fff;
      --ink:#111;
      --muted:#6b7280;
      --accent:#0ea5e9;
      --radius:16px;
      --shadow:0 8px 24px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:var(--bg);
      color:var(--ink);
      font-family:"Heebo","Rubik","Assistant",sans-serif;
      line-height:1.6;
      padding:20px;
    }
    h1{
      font-size:28px;
      margin-bottom:20px;
      font-weight:800;
    }
    .toolbar{
      display:flex;
      gap:10px;
      margin-bottom:20px;
      flex-wrap:wrap;
    }
    .btn{
      background:var(--card);
      border:1px solid #e5e7eb;
      padding:10px 16px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      transition:all 0.2s;
    }
    .btn:hover{
      background:#f3f4f6;
      transform:translateY(-1px);
    }
    .panel{
      background:var(--card);
      border:1px solid #e5e7eb;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      margin-bottom:30px;
      overflow:hidden;
    }
    #timeline{
      height:450px;
      width:100%;
    }
    .legend{
      display:flex;
      gap:15px;
      padding:15px;
      border-top:1px dashed #e5e7eb;
      flex-wrap:wrap;
    }
    .legend-item{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .dot{
      width:14px;
      height:14px;
      border-radius:50%;
    }
    .filter-row{
      padding:15px;
      border-bottom:1px dashed #e5e7eb;
      display:flex;
      gap:20px;
      flex-wrap:wrap;
      align-items:center;
    }
    table{
      width:100%;
      border-collapse:collapse;
    }
    th,td{
      padding:12px;
      text-align:right;
      border-bottom:1px solid #f1f5f9;
    }
    th{
      background:#fafafa;
      font-weight:700;
      position:sticky;
      top:0;
      z-index:1;
    }
    tr:hover{
      background:#fbfdff;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:5px 10px;
      border-radius:20px;
      font-size:13px;
      font-weight:600;
    }
    .progress-bar{
      width:120px;
      height:8px;
      background:#e5e7eb;
      border-radius:10px;
      overflow:hidden;
    }
    .progress-fill{
      height:100%;
      background:#22c55e;
      transition:width 0.3s;
    }
    .link{
      color:var(--accent);
      cursor:pointer;
      font-weight:600;
      text-decoration:none;
    }
    .link:hover{
      text-decoration:underline;
    }
    .table-container{
      max-height:500px;
      overflow:auto;
    }
    .vis-item .vis-item-content{
      padding:8px 12px;
      font-weight:700;
      white-space:nowrap;
    }
  </style>
</head>
<body>
  <h1>🗓️ לוח גאנט — בית הספר 2025–2026</h1>
  
  <div class="toolbar">
    <button class="btn" onclick="zoomIn()">🔍 התקרב</button>
    <button class="btn" onclick="zoomOut()">🔍 התרחק</button>
    <button class="btn" onclick="fitAll()">📅 התאם הכל</button>
  </div>

  <div class="panel">
    <div id="timeline"></div>
    <div class="legend" id="legend"></div>
  </div>

  <div class="panel">
    <div style="padding:15px;border-bottom:1px solid #e5e7eb">
      <h2 style="font-size:18px;font-weight:800">📋 טבלת משימות</h2>
    </div>
    
    <div class="filter-row">
      <strong>סינון:</strong>
      <label><input type="checkbox" class="filter" value="פדגוגי" checked> פדגוגי</label>
      <label><input type="checkbox" class="filter" value="קהילתי" checked> קהילתי</label>
      <label><input type="checkbox" class="filter" value="טכנולוגי" checked> טכנולוגי</label>
      <label><input type="checkbox" class="filter" value="מוסדי" checked> מוסדי</label>
      <label><input type="checkbox" class="filter" value="חברתי" checked> חברתי</label>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>תחום</th>
            <th>משימה</th>
            <th>התחלה</th>
            <th>סיום</th>
            <th>התקדמות</th>
            <th>פעולות</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const COLORS = {
      "פדגוגי": "#ef4444",
      "קהילתי": "#22c55e",
      "טכנולוגי": "#3b82f6",
      "מוסדי": "#a855f7",
      "חברתי": "#f59e0b"
    };

    const DATA = [
      {"id":1,"domain":"פדגוגי","name":"סדנת פתיחת שנה","start":"2025-09-01","end":"2025-09-01","progress":100},
      {"id":2,"domain":"מוסדי","name":"ذكرى المولد النبوي","start":"2025-09-03","end":"2025-09-04","progress":0},
      {"id":3,"domain":"חברתי","name":"נעלה לירושלים","start":"2025-10-05","end":"2025-10-05","progress":0},
      {"id":4,"domain":"חברתי","name":"חשיפה למקומות השמה","start":"2025-10-07","end":"2025-10-07","progress":0},
      {"id":5,"domain":"פדגוגי","name":"امتحانات تصنيف","start":"2025-10-12","end":"2025-10-16","progress":50},
      {"id":6,"domain":"טכנולוגי","name":"هيتك للعاشر 3","start":"2025-10-27","end":"2025-10-27","progress":0},
      {"id":7,"domain":"חברתי","name":"انتخاب ممثل صف","start":"2025-10-05","end":"2025-10-05","progress":0},
      {"id":8,"domain":"קהילתי","name":"פרוייקט להיות אזרח שכבה י'","start":"2025-10-20","end":"2025-10-20","progress":0},
      {"id":9,"domain":"קהילתי","name":"בחירות מועצת תלמידים","start":"2025-10-22","end":"2025-10-22","progress":0},
      {"id":10,"domain":"פדגוגי","name":"ישיבת מורים","start":"2025-11-24","end":"2025-11-24","progress":0},
      {"id":11,"domain":"פדגוגי","name":"מבחן כימיה וגיל הרך","start":"2025-11-30","end":"2025-11-30","progress":0},
      {"id":12,"domain":"פדגוגי","name":"מבחן אזרחות","start":"2025-12-02","end":"2025-12-02","progress":0},
      {"id":13,"domain":"פדגוגי","name":"מבחן התמחות","start":"2025-12-04","end":"2025-12-04","progress":0},
      {"id":14,"domain":"פדגוגי","name":"מבחן מתמטיקה","start":"2025-12-07","end":"2025-12-07","progress":0},
      {"id":15,"domain":"פדגוגי","name":"מבחן אנגלית","start":"2025-12-09","end":"2025-12-09","progress":0},
      {"id":16,"domain":"פדגוגי","name":"מבחן דת","start":"2025-12-11","end":"2025-12-11","progress":0},
      {"id":17,"domain":"פדגוגי","name":"מבחן היסטוריה","start":"2025-12-14","end":"2025-12-14","progress":0},
      {"id":18,"domain":"פדגוגי","name":"מבחן ערבית","start":"2025-12-16","end":"2025-12-16","progress":0},
      {"id":19,"domain":"פדגוגי","name":"מבחן עברית","start":"2025-12-18","end":"2025-12-18","progress":0},
      {"id":20,"domain":"פדגוגי","name":"הזנת ציונים במשוב","start":"2025-12-20","end":"2025-12-20","progress":0},
      {"id":21,"domain":"קהילתי","name":"ערב הורים","start":"2025-12-22","end":"2025-12-22","progress":0},
      {"id":22,"domain":"חברתי","name":"חלוקת תעודות","start":"2025-12-23","end":"2025-12-23","progress":0},
      {"id":23,"domain":"מוסדי","name":"חופשת האביב","start":"2025-12-24","end":"2026-01-05","progress":0}
    ];

    function parseDate(d) {
      return typeof d === 'number' ? new Date(d) : new Date(d);
    }

    const items = new vis.DataSet(
      DATA.map(item => {
        const s = parseDate(item.start);
        const e = parseDate(item.end);
        const isSameDay = s.getTime() === e.getTime();
        
        return {
          id: item.id,
          group: item.domain,
          content: item.name,
          start: s,
          end: isSameDay ? new Date(e.getTime() + 86400000) : e,
          title: item.name,
          type: 'range'
        };
      })
    );

    const groups = new vis.DataSet(
      Object.keys(COLORS).map(name => ({id: name, content: name}))
    );

    const legend = document.getElementById('legend');
    Object.entries(COLORS).forEach(([name, color]) => {
      const div = document.createElement('div');
      div.className = 'legend-item';
      div.innerHTML = `<span class="dot" style="background:${color}"></span><span>${name}</span>`;
      legend.appendChild(div);
    });

    const timeline = new vis.Timeline(
      document.getElementById('timeline'),
      items,
      groups,
      {
        locale: 'he',
        rtl: true,
        orientation: 'top',
        stack: true,
        zoomMin: 86400000 * 3,
        zoomMax: 86400000 * 400,
        start: new Date('2025-09-01'),
        end: new Date('2026-02-01'),
        margin: {item: 10},
        template: (item, el) => {
          el.style.background = COLORS[item.group];
          el.style.borderColor = COLORS[item.group];
          el.style.color = '#fff';
          return el;
        }
      }
    );

    function zoomIn() {
      const w = timeline.getWindow();
      const range = w.end - w.start;
      const center = w.start.valueOf() + range / 2;
      const newRange = range * 0.6;
      timeline.setWindow(center - newRange/2, center + newRange/2, {animation: 400});
    }

    function zoomOut() {
      const w = timeline.getWindow();
      const range = w.end - w.start;
      const center = w.start.valueOf() + range / 2;
      const newRange = range / 0.6;
      timeline.setWindow(center - newRange/2, center + newRange/2, {animation: 400});
    }

    function fitAll() {
      timeline.setWindow('2025-09-01', '2026-02-01', {animation: 400});
    }

    const tbody = document.getElementById('tableBody');
    const fmt = d => parseDate(d).toLocaleDateString('he-IL');

    let currentFilter = null;

    function renderTable() {
      tbody.innerHTML = '';
      const sorted = [...DATA].sort((a,b) => parseDate(a.start) - parseDate(b.start));
      
      sorted.forEach((item, i) => {
        if (currentFilter && !currentFilter.has(item.domain)) return;
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>
            <span class="chip" style="background:${COLORS[item.domain]}20;color:${COLORS[item.domain]}">
              <span class="dot" style="background:${COLORS[item.domain]}"></span>
              ${item.domain}
            </span>
          </td>
          <td><strong>${item.name}</strong></td>
          <td>${fmt(item.start)}</td>
          <td>${fmt(item.end)}</td>
          <td>
            <div class="progress-bar">
              <div class="progress-fill" style="width:${item.progress}%"></div>
            </div>
            <small>${item.progress}%</small>
          </td>
          <td>
            <a class="link" onclick="focusItem(${item.id})">הצג בגאנט</a>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function focusItem(id) {
      const item = items.get(id);
      if (!item) return;
      
      if (currentFilter && !currentFilter.has(item.group)) {
        document.querySelectorAll('.filter').forEach(inp => {
          if (inp.value === item.group) inp.checked = true;
        });
        applyFilter();
      }
      
      setTimeout(() => timeline.focus(id, {animation: 500}), 100);
    }
    window.focusItem = focusItem;

    function applyFilter() {
      const checks = [...document.querySelectorAll('.filter')];
      const selected = new Set(checks.filter(c => c.checked).map(c => c.value));
      
      currentFilter = selected.size === Object.keys(COLORS).length ? null : selected;
      
      if (currentFilter) {
        const filtered = items.get().filter(it => currentFilter.has(it.group));
        timeline.setItems(new vis.DataSet(filtered));
        timeline.setGroups(new vis.DataSet(
          [...currentFilter].map(name => ({id: name, content: name}))
        ));
      } else {
        timeline.setItems(items);
        timeline.setGroups(groups);
      }
      
      renderTable();
    }

    document.querySelectorAll('.filter').forEach(inp => {
      inp.addEventListener('change', applyFilter);
    });

    renderTable();
  </script>
</body>
</html>
